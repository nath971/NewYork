<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>New York les garsss üóΩ</title>
    <style>
        :root {
            --nyc-yellow: #FFDE00;
            --nyc-black: #111111;
            --nyc-grey: #f4f4f4;
            --nyc-dark-grey: #333;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: var(--nyc-grey);
            color: var(--nyc-black);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            -webkit-tap-highlight-color: transparent;
        }

        /* HEADER STYLE */
        header {
            background-color: var(--nyc-black);
            color: var(--nyc-yellow);
            padding: 20px 10px;
            text-align: center;
            border-bottom: 5px solid var(--nyc-yellow);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        header h1 {
            margin: 0;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        header p {
            margin: 5px 0 0;
            font-size: 0.9rem;
            color: #fff;
        }

        /* CONTAINER */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 80px;
        }

        /* INFO CARD */
        .info-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-left: 5px solid var(--nyc-yellow);
        }

        .info-card h3 { margin-top: 0; }

        /* NAVIGATION TABS */
        .tabs {
            display: flex;
            overflow-x: auto;
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; 
            -ms-overflow-style: none;
        }
        
        .tabs::-webkit-scrollbar { 
            display: none; 
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            color: var(--nyc-dark-grey);
            white-space: nowrap;
            transition: 0.3s;
            border-bottom: 4px solid transparent;
            flex-shrink: 0;
        }

        .tab-btn:hover { background-color: #f9f9f9; }

        .tab-btn.active {
            border-bottom: 4px solid var(--nyc-yellow);
            background-color: #fffbe6;
        }

        /* CONTENT SECTIONS */
        .day-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .day-content.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .activity-block {
            background: white;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: flex-start;
            gap: 15px;
            position: relative;
        }

        .activity-time {
            background-color: var(--nyc-black);
            color: var(--nyc-yellow);
            padding: 8px 10px;
            border-radius: 6px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            min-width: 55px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
        }

        /* FORMULAIRE AJOUT */
        .add-activity-container {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border: 2px dashed #ddd;
        }

        .add-activity-form { display: grid; gap: 10px; }
        .form-row { display: flex; gap: 10px; align-items: flex-end; }
        .form-group { flex: 1; }

        .time-label {
            display: block;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--nyc-dark-grey);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: inherit;
            font-size: 16px;
        }

        button.add-btn {
            background-color: var(--nyc-yellow);
            color: var(--nyc-black);
            border: none;
            padding: 12px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 4px;
            width: 100%;
            transition: 0.2s;
        }

        button.add-btn:hover {
            background-color: #e6c800;
            transform: translateY(-2px);
        }

        button.add-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* CHECKBOX */
        .check-container {
            display: block;
            position: relative;
            padding-left: 35px;
            cursor: pointer;
            user-select: none;
            min-width: 20px;
        }

        .check-container input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 25px;
            width: 25px;
            background-color: #eee;
            border-radius: 5px;
        }

        .check-container:hover input~.checkmark { background-color: #ccc; }
        .check-container input:checked~.checkmark { background-color: var(--nyc-black); }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        .check-container input:checked~.checkmark:after { display: block; }

        .check-container .checkmark:after {
            left: 9px;
            top: 5px;
            width: 5px;
            height: 10px;
            border: solid var(--nyc-yellow);
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }

        /* DETAILS & BADGES */
        .details { flex: 1; }
        .details h4 { margin: 0 0 5px 0; font-size: 1.1rem; word-break: break-word; }
        .details p { margin: 0; font-size: 0.95rem; color: #555; word-break: break-word; }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-top: 5px;
        }
        
        /* --- COULEURS DES NOUVEAUX TYPES --- */
        .badge-food { background-color: #ffecb3; color: #856404; } /* Jaune */
        .badge-walk { background-color: #d4edda; color: #155724; } /* Vert */
        .badge-must { background-color: #f8d7da; color: #721c24; } /* Rouge clair */
        
        .badge-visit { background-color: #cce5ff; color: #004085; } /* Bleu */
        .badge-shop { background-color: #e0cffc; color: #3e0075; } /* Violet */
        .badge-party { background-color: #fcc2d7; color: #a61e4d; } /* Rose */
        .badge-trans { background-color: #e2e3e5; color: #383d41; } /* Gris */

        .delete-btn {
            color: #ff4444;
            background: transparent;
            border: 2px solid transparent;
            cursor: pointer;
            font-size: 1.5rem;
            margin-left: auto;
            padding: 0px 10px;
            line-height: 1;
            transition: 0.2s;
        }
        .delete-btn:hover { color: #cc0000; }

        /* FOOTER */
        footer {
            text-align: center;
            padding: 20px;
            background-color: var(--nyc-black);
            color: #888;
            font-size: 0.8rem;
            margin-top: 40px;
        }

        /* STYLE MOBILE */
        @media screen and (max-width: 768px) {
            header h1 { font-size: 1.4rem; }
            
            .container {
                padding: 10px;
                padding-bottom: 60px;
            }

            .activity-block {
                padding: 12px;
                gap: 10px;
            }

            .activity-time {
                font-size: 0.9rem;
                padding: 5px;
                min-width: 50px;
            }

            .form-row {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .add-btn {
                margin-top: 5px;
            }

            .tabs {
                margin: 0 -10px 20px -10px;
                border-radius: 0;
            }
            
            .check-container {
                padding-left: 30px;
            }
        }
    </style>
</head>

<body>

    <header>
        <h1>New York les garsss üá∫üá∏</h1>
        <p>11 Mars - 18 Mars 2026</p>
    </header>

    <div class="container">
        <div class="info-card">
            <h3>üìç QG : Holiday Inn Times Square</h3>
            <p><strong>Team :</strong> 3 √©tudiants (Gwada represent üá¨üáµ)</p>
            <p><strong>Info :</strong> Planning live üî•</p>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="openDay(event, 'day1')">Mer 11</button>
            <button class="tab-btn" onclick="openDay(event, 'day2')">Jeu 12</button>
            <button class="tab-btn" onclick="openDay(event, 'day3')">Ven 13</button>
            <button class="tab-btn" onclick="openDay(event, 'day4')">Sam 14</button>
            <button class="tab-btn" onclick="openDay(event, 'day5')">Dim 15</button>
            <button class="tab-btn" onclick="openDay(event, 'day6')">Lun 16</button>
            <button class="tab-btn" onclick="openDay(event, 'day7')">Mar 17</button>
            <button class="tab-btn" onclick="openDay(event, 'day8')">Mer 18</button>
        </div>

        <div id="day1" class="day-content active"></div>
        <div id="day2" class="day-content"></div>
        <div id="day3" class="day-content"></div>
        <div id="day4" class="day-content"></div>
        <div id="day5" class="day-content"></div>
        <div id="day6" class="day-content"></div>
        <div id="day7" class="day-content"></div>
        <div id="day8" class="day-content"></div>
    </div>

    <footer>
        <p>G√©n√©r√© par ton Assistant Voyage IA ü§ñ<br>New York City 2026</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBjVkf-vdIqzEZdoUPJAa_xlRIzfsPE_fA",
            authDomain: "nyc-planning.firebaseapp.com",
            projectId: "nyc-planning",
            storageBucket: "nyc-planning.firebasestorage.app",
            messagingSenderId: "1082683859444",
            appId: "1:1082683859444:web:e3893f0edef6eed91e99a1",
            measurementId: "G-DNCJWMPD2X"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.openDay = function(evt, dayName) {
            var i, dayContent, tabBtn;
            dayContent = document.getElementsByClassName("day-content");
            for (i = 0; i < dayContent.length; i++) {
                dayContent[i].style.display = "none";
                dayContent[i].classList.remove("active");
            }
            tabBtn = document.getElementsByClassName("tab-btn");
            for (i = 0; i < tabBtn.length; i++) {
                tabBtn[i].className = tabBtn[i].className.replace(" active", "");
            }
            document.getElementById(dayName).style.display = "block";
            document.getElementById(dayName).classList.add("active");
            if (evt) evt.currentTarget.className += " active";
        };

        const q = query(collection(db, "activities"), orderBy("time"));
        onSnapshot(q, (snapshot) => {
            document.querySelectorAll('.day-content').forEach(div => {
                div.innerHTML = ''; 
                appendAddForm(div);
            });

            snapshot.forEach((doc) => {
                const data = doc.data();
                const dayDiv = document.getElementById(data.dayId);
                
                if (dayDiv) {
                    const activityHTML = createActivityElement(doc.id, data);
                    const formContainer = dayDiv.querySelector('.add-activity-container');
                    dayDiv.insertBefore(activityHTML, formContainer);
                }
            });
        });

        // --- GESTION DE L'AFFICHAGE DES BADGES ---
        function createActivityElement(id, data) {
            const div = document.createElement('div');
            div.className = 'activity-block';
            div.dataset.id = id;

            let badgeHtml = '';
            if (data.type) {
                let label = "Activity";
                // Mapping des types
                if (data.type.includes('food')) label = "Food";
                if (data.type.includes('walk')) label = "Marche";
                if (data.type.includes('must')) label = "Immanquable";
                if (data.type.includes('visit')) label = "Visite";
                if (data.type.includes('shop')) label = "Shopping";
                if (data.type.includes('party')) label = "Soir√©e";
                if (data.type.includes('trans')) label = "Transport";
                
                badgeHtml = `<span class="badge ${data.type}">${label}</span>`;
            }

            div.innerHTML = `
                <div class="activity-time">${data.time}</div>
                <label class="check-container">
                    <input type="checkbox" ${data.checked ? 'checked' : ''} class="act-checkbox">
                    <span class="checkmark"></span>
                </label>
                <div class="details">
                    <h4>${data.title}</h4>
                    ${badgeHtml}
                    <p>${data.desc}</p>
                </div>
                <button class="delete-btn">√ó</button>
            `;

            div.querySelector('.delete-btn').addEventListener('click', () => deleteActivity(id));
            div.querySelector('.act-checkbox').addEventListener('change', (e) => toggleCheck(id, e.target.checked));

            return div;
        }

        // --- AJOUT DES OPTIONS DANS LE FORMULAIRE ---
        function appendAddForm(parentDiv) {
            const formDiv = document.createElement('div');
            formDiv.className = 'add-activity-container';
            formDiv.innerHTML = `
                <h4>‚ûï Ajouter une activit√©</h4>
                <div class="add-activity-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="time-label">Heure :</label>
                            <input type="time" class="new-act-time" required>
                        </div>
                        <div class="form-group" style="flex: 2;">
                             <label class="time-label">&nbsp;</label> 
                            <input type="text" class="new-act-title" placeholder="Titre (ex: Resto)" required>
                        </div>
                    </div>
                    <textarea class="new-act-desc" rows="2" placeholder="Description..."></textarea>
                    <div class="form-row">
                        <select class="new-act-type">
                            <option value="">Type (Aucun)</option>
                            <option value="badge-food">Food üçî</option>
                            <option value="badge-walk">Marche üö∂</option>
                            <option value="badge-must">Must üî•</option>
                            <option value="badge-visit">Visite üóΩ</option>
                            <option value="badge-shop">Shopping üõçÔ∏è</option>
                            <option value="badge-party">Soir√©e ü•≥</option>
                            <option value="badge-trans">Transport üöá</option>
                        </select>
                        <button class="add-btn">Ajouter au Cloud ‚òÅÔ∏è</button>
                    </div>
                </div>
            `;
            
            formDiv.querySelector('.add-btn').addEventListener('click', function() {
                addActivityToFirebase(this, parentDiv.id);
            });

            parentDiv.appendChild(formDiv);
        }

        async function addActivityToFirebase(btn, dayId) {
            const container = btn.closest('.add-activity-container');
            const time = container.querySelector('.new-act-time').value;
            const title = container.querySelector('.new-act-title').value;
            const desc = container.querySelector('.new-act-desc').value;
            const type = container.querySelector('.new-act-type').value;

            if (!title) {
                alert("Il faut au moins un titre !");
                return;
            }

            btn.disabled = true;
            btn.innerText = "Envoi...";

            try {
                await addDoc(collection(db, "activities"), {
                    dayId: dayId,
                    time: time || "??:??",
                    title: title,
                    desc: desc,
                    type: type,
                    checked: false,
                    createdAt: Date.now()
                });
                
                container.querySelector('.new-act-time').value = '';
                container.querySelector('.new-act-title').value = '';
                container.querySelector('.new-act-desc').value = '';
                container.querySelector('.new-act-type').value = '';
            } catch (e) {
                console.error("Erreur d'ajout: ", e);
                alert("Erreur lors de l'ajout. V√©rifie ta connexion.");
            }
            
            btn.disabled = false;
            btn.innerText = "Ajouter au Cloud ‚òÅÔ∏è";
        }

        async function deleteActivity(id) {
            if(confirm("Supprimer pour tout le monde ?")) {
                await deleteDoc(doc(db, "activities", id));
            }
        }

        async function toggleCheck(id, isChecked) {
            await updateDoc(doc(db, "activities", id), {
                checked: isChecked
            });
        }
    </script>

</body>
</html>
